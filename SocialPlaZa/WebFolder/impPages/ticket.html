<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html>	<head>		<link rel="stylesheet" type="text/css" href="../bootstrap/css/bootoragen.css"> 		<meta http-equiv="Content-type" content="text/html; charset=utf-8" />		<title>jQuery Print Plugin</title>    <script src="../extscripts/jquery-1.4.4.min.js" type="text/javascript"></script>  <script>  var docActual = localStorage.docActual;var tablaHTML;var totalHTML;var ruta = '/rest/DocComercial('+docActual+')/';$.getJSON( ruta, function(data) {	//Cabecera del Ticket	var doc = data;	$('body').css({'max-width':'280px','font-size':'70%'});	pintar("<img src='../../images/partner/logo-wakanda_2.png'></img><br>");	pintar("<h4>Nombre de la tienda</h4>");	function replaceAll( text, busca, reemplaza ){	  while (text.toString().indexOf(busca) != -1)	      text = text.toString().replace(busca,reemplaza);	  return text;	}	var fecha = replaceAll(data.Fecha,"!"," / ");	pintar("<h5><b>Ticket nº "+data.Numero+"</b></h5>");	pintar("<h5><b>Fecha: "+fecha+"</b></h5><br>");	procesarDoc();});var procesarDoc = function (){var ruta = '/rest/DocComercial('+docActual+')/lineasCollection?$expand=lineasCollection';$.getJSON( ruta, function(data) {   var lineas = data.lineasCollection.__ENTITIES;	pintar("<table width = '280px'><tr><td width ='180px'><b>Descripción</b></td><td><b>P.U.</b></td><td><b>Cant.</b></td><td><b>Imp.</b></td></tr></table>");	tablaHTML = "<table class='table table-condensed'>";		    for (var idx in lineas)    {        linea = lineas[idx];       // var tabla = getHtmlObj('container4');       		tablaHTML += "<tr><td>"+ linea.Descripcion+ "</td>";		tablaHTML += "<td>" + linea.PrecioUnitario + "</td>";        tablaHTML += "<td>" + linea.Cantidad + "</td>";		tablaHTML += "<td>" + linea.Importe + "</td></tr>";    }		tablaHTML += "</table>";	$('body').append(tablaHTML);    	var total = localStorage.Total;	var totalHTML = "<h5>Total IVA incluido: "+total+" €</h5>";	$('body').append(totalHTML);	procesarMovimientos(); });}var procesarMovimientos = function (){	var ruta2 = '/rest/DocComercial('+docActual+')/cajasMovimientosCollection?$expand=cajasMovimientosCollection';	var j = $.getJSON( ruta2, function(data) {		var movimientos = data.cajasMovimientosCollection.__ENTITIES;		for (var idx in movimientos){			var movimiento = movimientos[idx];			var mpActual = movimiento.MedioPago.__deferred.__KEY; //ds ID del medio de pago			procesarMedio(movimiento.entregado,mpActual);		}	});}	var procesarMedio = function(movimiento,mpActual) {	var ruta3 = '/rest/MedioPago('+mpActual+')';	$.getJSON( ruta3, function(data){		var mediopago = data;		var cambio = localStorage.cambio;		if(mediopago.Descripcion && cambio!="0"){			pintar("<ul><li><b>"+mediopago.Descripcion+"</b> : "+movimiento+"€</li></ul>");			pintar("<ul><li><b>Cambio</b> : "+cambio+"</li></ul>");			localStorage.cambio = "0";		}else{			pintar("<ul><li><b>"+mediopago.Descripcion+"</b> : "+movimiento+"€</li></ul>");			}	});}var pintar = function(codigo) {	$('body').append(codigo);localStorage.removeItem(docActual);}	  </script>	</head>	<body>		</body></html>