//********* INICIALIZACIÓN DE LLAMADAS *********\\btmodales = {};btmodales.initModal = function (clase,$comp){	var ruta = '/rest/'+clase;$.getJSON( ruta, function(data) {   var usuarios = data.__ENTITIES;     // var usuario;         for (var idx in usuarios)    {        usuario = usuarios[idx];                  } btmodales.modalUsuario($comp);		 });}//********* MODALES DE BOOTSTRAP *********\\btmodales.modalUsuario = function ($comp) {var modal = '<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">'+' <div class="modal-header">'// CABECERA+'    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>'+'    <h3 id="myModalLabel">'+usuario.NombreAcceso+'</h3>'+'  </div>'+'  <div class="modal-body">'// CUERPO+'    <p>Entidad: '+ usuario.Entidad.__deferred.__KEY +'</p>'+'    <p>Entorno: '+ usuario.Entorno.__deferred.__KEY +'</p>'+' <label>Nombre de usuario</label>'+'<input type="text" data-provide="typeahead" class="entrada left form" id="nombreAcceso" value="'+usuario.NombreAcceso+'">'+' <label>Contraseña</label>'+'<input type="text" data-provide="typeahead" class="entrada left form" value="'+usuario.Password+'" disabled>'+'</div>'//-> CUERPO+'  <div class="modal-footer">'// PIE+'    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>'+'  <button class="btn btn-primary" id="guardar">Save changes</button>'+'  </div>'+'</div>';$('body').append(modal);};btmodales.modalEmpresa = function ($comp){//-- CREACION DEL DATASOURCE --\\WAF.dataSource.create({  'id': 'entidades',   'binding': 'Entidades',  'data-source-type': 'dataClass'});//Carga del datasourcesources.entidades.allEntities({		onSuccess: function (){				//IMPORTANTE ¡¡ ==> TRAERNOS LA ENTIDAD QUE QUEREMOS				sources.entidades.select(1);		sources.entidades.getCurrentElement();					var posicionPais = ds.PaisesISO.devolverPos(sources.entidades.ID);				if(posicionPais != false){				sources.paisesISO.select(posicionPais);			}						//-- CREACION DEL CONTAINER DE LA FICHA WAKANDA --\\				var myContainer1 = new WAF.widget.Container({		     'id': 'modal_empresa',		     'data-type': 'container',		     'data-lib': 'WAF',		     'data-constraint-top': 'true'		});		var myContainer2 = new WAF.widget.Container({		     'id': 'modal_empresa_cuerpo',		     'data-type': 'container',		     'data-lib': 'WAF',		     'data-constraint-top': 'true'		});		var myContainer3 = new WAF.widget.Container({		     'id': 'modal_footer_empresa',		     'data-type': 'container',		     'data-lib': 'WAF',		     'data-constraint-top': 'true'		});				//-- CREACION DE LOS DIV MODALES HTML --\\								var modal = '<div id="modal_empresa" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">'		+' <div class="modal-header">'// CABECERA		+'    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>'		+'    <h3 id="myModalLabel">Ficha de Empresa</h3>'		+'  </div>'		+'  <div id="modal_empresa_cuerpo" class="modal-body">'// CUERPO		+'</div>'		+'  <div class="modal-footer" id="modal_footer_empresa" >'// PIE		+'    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>'		+'  </div>'		+'</div>';		// Añadir los div modales HTML		$('body').append(modal);				// Añadir los div modales WAKANDA		$$("MainComp").addChild(myContainer1);		$$("modal_empresa").addChild(myContainer2);		$$("modal_empresa").addChild(myContainer3);		//-- CREACION DE LOS TEXT-INPUT Y BOTON GUARDAR--\\				btmodales.crearInput("txt_nombre","Nombre","entidades.Nombre",[sources.entidades.Nombre]);		btmodales.crearInput("txt_direccion","Direccion","entidades.Direccion",[sources.entidades.Direccion]);		btmodales.crearInput("txt_nif","N.I.F.","entidades.NIF",[sources.entidades.NIF]);		btmodales.crearInput("txt_cp","Codigo Postal","entidades.CodigoPostal",[sources.entidades.CodigoPostal]);		btmodales.crearInputPais("txt_pais","Pais","paisesISO.Name",[sources.paisesISO.Name]);		btmodales.crearInputFile();		btmodales.crearBotonGuardar();		//Funcion de guardar entidad empresa		$$('btn_guardar').addListener('click',function() {			if($('#file1').val()!=null ){				sources.entidades.subirImagen($('#file1').val());											}			sources.entidades.save({				onSuccess:function(){					sources.entidades.serverRefresh();					console.log(sources.entidades.Logotipo);					ds.Entidades.asignarPais(sources.entidades.ID,sources.paisesISO.Name);					$('#modal_empresa').modal('hide');				}			});			});			}});	};	btmodales.crearInput = function (id,etiqueta,valor1,valor2){		var inputElement = document.createElement('input'); //HTML tag    inputElement.setAttribute('id',id);    inputElement.setAttribute('value',valor2);    var label = "<label>"+etiqueta+"</label>";    $('#modal_empresa_cuerpo').append(label);    $('#modal_empresa_cuerpo').append(inputElement);	    var textInput = new WAF.widget.TextField({		'id': id,		'data-type': 'textField',		'data-lib': 'WAF',		'class': 'entrada left form',		'data-binding': valor1    });    $$("modal_empresa_cuerpo").addChild(textInput);   }btmodales.crearInputPais = function (id,etiqueta,valor1,valor2){		var inputElement = document.createElement('input'); //HTML tag    inputElement.setAttribute('id',id);    inputElement.setAttribute('value',valor2);    var label = "<label>"+etiqueta+"</label>";    $('#modal_empresa_cuerpo').append(label);    $('#modal_empresa_cuerpo').append(inputElement);	    var textInput = new WAF.widget.TextField({		'id': id,		'data-type': 'textField',		'data-lib': 'WAF',		'data-autocomplete': 'true',		'class': 'entrada left form',		'data-binding': valor1    });    $$("modal_empresa_cuerpo").addChild(textInput);   }btmodales.crearBotonGuardar = function () {	 var buttonElement = document.createElement('button'); //HTML tag     buttonElement.setAttribute('id','btn_guardar'); // ID that links to the widget constructor ID     buttonElement.setAttribute('class','btn btn-primary');     $('.modal-footer').append(buttonElement);      // create an instance of our Button widget      var nextButton = new WAF.widget.Button({    	  'id': 'btn_guardar',	      'data-lib': 'WAF',	      'data-type': 'button',	      'data-text': 'Save',	      'data-binding': 'entidades'     });     $$("modal_footer_empresa").addChild(nextButton);}btmodales.crearInputFile = function () {	 var file = document.createElement('input'); //HTML tag     file.setAttribute('id','file1'); // ID that links to the widget constructor ID     file.setAttribute('type','file');     var label = "<label>Logotipo</label>";    $('#modal_empresa_cuerpo').append(label);    $('#modal_empresa_cuerpo').append(file);    $('#file1').val(null);        var imageElement = document.createElement('div'); //HTML tag    imageElement.setAttribute('id','modal_logotipo');    var label = "<label>Logotipo2</label>";    $('#modal_empresa_cuerpo').append(label);    $('#modal_empresa_cuerpo').append(imageElement);        var imageWak = new WAF.widget.Image({    	  'id': 'modal_logotipo',	      'data-lib': 'WAF',	      'data-type': 'image',	      'data-fit': '1',	      'data-binding': 'entidades.Logotipo'     });     $$("modal_empresa_cuerpo").addChild(imageWak);        //------------------------------    //------------------------------      }//-> ********* MODALES DE BOOTSTRAP *********\\//********* INICIALIZACIÓN DE LLAMADAS *********\\btmodales.getPendientes = function ($comp){ 	    var emps = $comp.sources.docComercial; // we put the datasource in a variable    var numelem = emps.length;  // we get the size of the current entity collection    console.log(emps.length);    var html = "";     for (var i = 0; i < numelem; i++) // for each element of the entity collection    {        emps.getElement(i, { onSuccess: function(event) // we get the element of position i          {            var elem = event.element; // elem contains a summarized copy of the datasource            html += elem.firstname+" <b>"+elem.name+"</b>"+" works for <I>"+elem.getAttributeValue("employer.name")+"</I><br/>";                    // Direct access for reading storage attributes of the element                    // Access through getAttributValue to relation attributes                    // In order for this access to work, you must declare the dependencies            if (event.userData.onLastEntity) // custom boolean value calculated in the userData param (see below),                                        // returns true only during processing the last entity            {                $("#display").html(html); // Display in the container                        // Must be called after processing last entity (asynchronous call)                        console.log(html);            }        },         userData: {onLastEntity: i == numelem-1} // object passed in the userData      });    }	 }//********* MODALES DE BOOTSTRAP *********\\btmodales.modalListaRegistros = function () {var modalListado = '<div id="modalLista" class="modal hide" tabindex="-1" role="dialog" aria-labelledby="modalListalLabel" aria-hidden="true">'+' <div class="modal-header">'// CABECERA+'    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>'+'    <h3 id="myModalLabel">Tickets Pendientes</h3>'+'  </div>'+'  <div id="modalListaBody" class="modal-body" style="max-height:250px;>'// CUERPO//Aquí append lo que corresponda.+'</div>'//-> CUERPO+'  <div class="modal-footer">'// PIE+'    <button class="btn" data-dismiss="modal" aria-hidden="true">Cerrar</button>'//+'  <button class="btn btn-primary" id="guardar">Save changes</button>'+'  </div>'+'</div>';$('body').append(modalListado);};//********* Bienvenido *********\\btmodales.modalBienvenido = function ($comp) {var modal = '<div id="modalBienvenido" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">'+' <div class="modal-header">'// CABECERA+'    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>'+'    <h3 id="myModalLabel">Bienvenido</h3>'+'  </div>'+'  <div class="modal-body">'// CUERPO+'    <p>Hola Qué tal</p>'+'</div>'//-> CUERPO+'  <div class="modal-footer">'// PIE+'    <button class="btn" data-dismiss="modal" aria-hidden="true">Entrar</button>'+'  </div>'+'</div>';$('body').append(modal);};